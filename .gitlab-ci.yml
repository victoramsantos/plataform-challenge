image: gradle:5.2-jdk8

variables:
  DOCKERFILE_PATH: "./parte1"
  DOCKER_REPOSITORY: "victoramsantos"
  IMAGE_NAME: "plataform-challenge"
  IMAGE_VERSION: "prd"
  APPLICATION_PATH: "./app"

stages:
  - build
  - test
  - packing

gradle_build:
  stage: build
  script:
    - cd $APPLICATION_PATH
    - ./gradlew clean build

gradle_test:
  stage: test
  script:
    - echo "gradle test"

docker_build_push:
  stage: packing
  script:
    - echo "docker build . -f ${DOCKERFILE_PATH}/Dockerfile -t ${IMAGE_NAME}:${IMAGE_VERSION}"
    - echo "docker push ${DOCKER_REPOSITORY}/${IMAGE_NAME}:${IMAGE_VERSION}"
  only:
    - master
